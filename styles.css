:root {
  --container-bg: #0f0f0f;
  --text-color: #ffffff;
  --card-bg: #1a1a1a;
  --card-border: #333333;
  --line-stroke: #555555;
}

* { box-sizing: border-box; }
html, body, #app-root { height: 100%; }
body {
  margin: 0;
  background: var(--container-bg);
  color: var(--text-color);
  font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
}

.toolbar {
  position: sticky;
  top: 0;
  z-index: 10;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 16px;
  background: rgba(18,18,18,0.9);
  border-bottom: 1px solid #222;
  backdrop-filter: blur(8px);
}
.toolbar .legend { margin-left: 12px; opacity: 0.9; }
.status-dot {
  display: inline-block;
  width: 10px;
  height: 10px;
  border-radius: 50%;
  margin-right: 6px;
  box-shadow: 0 0 6px rgba(255,255,255,0.25);
}
.status-active { background: #00ff00; box-shadow: 0 0 10px rgba(0,255,0,0.5); }
.status-idle   { background: #ffd700; box-shadow: 0 0 10px rgba(255,215,0,0.5); }
.status-error  { background: #ff4500; box-shadow: 0 0 10px rgba(255,69,0,0.5); }

.btn {
  appearance: none;
  border: 1px solid #444;
  background: transparent;
  color: #ccc;
  border-radius: 8px;
  padding: 8px 14px;
  font-weight: 600;
  cursor: pointer;
  transition: transform 120ms ease, background 120ms ease, color 120ms ease;
}
.btn:hover { background: #2a2a2a; color: #fff; }
.btn-primary {
  border: none;
  background: #3f45c8; /* flat, no gradients per DO_NOT_APPLY_TO */
  color: #fff;
}
.btn-primary:hover { transform: scale(1.05); background: #4a53d8; }

.canvas-container {
  position: relative;
  height: calc(100vh - 56px);
  overflow: hidden; /* prevent default scrollbars; zoom/pan handles navigation */
}
.stage {
  position: relative;
  transform-origin: 0 0;
  will-change: transform; /* smoother zoom/pan */
}
.connections {
  position: absolute;
  inset: 0;
  /* width/height are set dynamically to content size */
  pointer-events: none;
}
.cards-layer {
  position: absolute;
  inset: 0;
  /* width/height are set dynamically to content size */
}

.zoom-controls {
  position: absolute;
  right: 16px;
  bottom: 16px;
  display: flex;
  gap: 8px;
}

.agent-card {
  position: absolute;
  /* actual width/height applied inline for responsiveness */
  background: var(--card-bg);
  color: #fff;
  border: 1px solid var(--card-border);
  border-radius: 12px;
  padding: 18px 20px;
  box-shadow: 0 8px 32px rgba(0,0,0,0.4);
  user-select: none;
  transition: transform 150ms ease, box-shadow 150ms ease, border-color 150ms ease;
}
.agent-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 12px 40px rgba(0,0,0,0.6);
  border-color: #444444;
}
.agent-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; }
.agent-title { font-weight: 700; font-size: 18px; }
.agent-role { opacity: 0.85; font-size: 13px; }
.dept-tag { display: inline-block; padding: 8px 14px; border-radius: 8px; font-size: 12px; font-weight: 700; margin-bottom: 10px; }
.metrics { display: flex; gap: 14px; margin-top: 12px; opacity: 0.95; font-size: 13px; }
.controls { display: flex; gap: 10px; margin-top: 12px; flex-wrap: wrap; }
.control-btn { border: 1px solid #444; background: transparent; color: #ccc; padding: 8px 12px; border-radius: 10px; cursor: pointer; }
.control-btn:hover { background: #2a2a2a; color: #fff; }

.connection-path { stroke: var(--line-stroke); stroke-width: 3; fill: none; opacity: 0.7; pointer-events: auto; vector-effect: non-scaling-stroke; }

/* Testing connection styles */
.connection-path.testing {
  stroke: var(--testing-line-stroke, #22c55e);
  stroke-width: var(--testing-line-width, 2.5);
  stroke-dasharray: var(--testing-line-dash, 6 6);
  opacity: 0.9;
}

/* Agent detail panel */
.detail-panel {
  position: fixed;
  top: 56px;
  right: 0;
  width: clamp(var(--overlay-width-min, 300px), var(--overlay-width-pref, 45vw), var(--overlay-width-max, 900px));
  max-width: 92vw;
  height: calc(100vh - 56px);
  background: var(--sidepanel-bg, var(--card-bg));
  color: var(--sidepanel-color, inherit);
  border-left: var(--sidepanel-border-left, 1px solid var(--card-border));
  box-shadow: var(--sidepanel-shadow, -8px 0 24px rgba(0,0,0,0.4));
  padding: var(--sidepanel-padding, 16px);
  overflow: auto;
  z-index: 45;
  transform: translateX(100%);
  transition: transform 220ms ease;
}
.detail-panel.open { transform: translateX(0); }
.detail-panel[aria-hidden="true"] { pointer-events: none; }
.detail-panel h3 { margin: 0 0 8px; }
.detail-panel .subtle { opacity: 0.8; font-size: 12px; margin-bottom: 12px; }
.task-list { list-style: none; padding: 0; margin: 12px 0; display: flex; flex-direction: column; gap: 8px; }
.task-item { border: 1px solid var(--card-border); border-radius: 8px; padding: 10px; background: #151515; }
.task-item .meta { display: flex; gap: 8px; font-size: 12px; opacity: 0.85; align-items: center; flex-wrap: wrap; }
.task-actions { display: flex; gap: 8px; margin-top: 8px; }
.task-actions .link { color: #9aa0ff; cursor: pointer; }
.task-actions .link:hover { text-decoration: underline; }
.task-form { display: grid; gap: 8px; margin-top: 16px; }
.task-form input, .task-form select, .task-form textarea { width: 100%; background: #111; color: #fff; border: 1px solid #333; border-radius: 6px; padding: 8px; }
.task-form textarea { min-height: 80px; }

/* Side panel scrollbar for detail-panel (WebKit) */
.detail-panel::-webkit-scrollbar { width: var(--sidepanel-scrollbar-width, 8px); }
.detail-panel::-webkit-scrollbar-track { background: var(--sidepanel-scrollbar-bg, #1A1A1A); }
.detail-panel::-webkit-scrollbar-thumb { background: var(--sidepanel-scrollbar-thumb-bg, #333333); border-radius: var(--sidepanel-scrollbar-thumb-radius, 4px); }

/* Firefox */
.detail-panel { scrollbar-width: thin; scrollbar-color: var(--sidepanel-scrollbar-thumb-bg, #333333) var(--sidepanel-scrollbar-bg, #1A1A1A); }

/* Task status pills */
.task-status { display: inline-flex; align-items: center; gap: 6px; padding: 2px 8px; border-radius: 999px; font-size: 11px; }
.task-status.pending { background: #2a2a1a; color: #f5d76e; border: 1px solid #6a5b2a; }
.task-status.in-progress { background: #1a2a2a; color: #6ee7d8; border: 1px solid #2a6a6a; }
.task-status.done { background: #1a2a1a; color: #86efac; border: 1px solid #2a6a2a; }

/* Time summary */
.time-summary { display: grid; gap: 8px; margin: 8px 0 12px; }
.time-total { font-size: 13px; opacity: 0.9; }
.time-chart { width: 100%; height: 64px; border: 1px solid #2a2a2a; border-radius: 8px; background: #101010; padding: 6px; display: grid; align-items: end; grid-auto-flow: column; gap: 6px; }
.time-bar { background: #4a53d8; border-radius: 4px 4px 0 0; }
.time-bar.low { background: #60a5fa; }
.time-bar.medium { background: #8b5cf6; }
.time-bar.high { background: #f472b6; }

/* Time estimate pill for clarity */
.time-pill {
  display: inline-flex;
  margin-left: 6px;
  padding: 1px 6px;
  border-radius: 999px;
  border: 1px solid #2a2a2a;
  background: #0f0f0f;
  color: #d1d5db;
}

/* Backdrop for agent panel */
.backdrop {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.5);
  z-index: 40;
  opacity: 0;
  transition: opacity 200ms ease;
}
.backdrop.hidden { display: none; }
.backdrop.visible { display: block; opacity: 1; }

/* Tooltip for testing connections */
.tooltip { position: fixed; background: #111; color: #fff; border: 1px solid #333; border-radius: 6px; padding: 6px 8px; font-size: 12px; pointer-events: none; z-index: 30; }
.tooltip.hidden { display: none; }

/* Empty states */
.empty { opacity: 0.8; font-size: 13px; border: 1px dashed #333; padding: 12px; border-radius: 8px; text-align: center; }

/* Department card layout enhancements */
.dept-card {
  display: grid;
  grid-template-rows: auto auto auto;
  gap: 10px;
}
.dept-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  margin-bottom: 4px;
}
.dept-title { font-size: 18px; font-weight: 800; }
.dept-subtitle { font-size: 13px; opacity: 0.85; }

.dept-meta {
  display: flex;
  align-items: center;
  flex-wrap: wrap;
  gap: 8px 12px;
  font-size: 12px;
  opacity: 0.95;
}
.dept-meta .meta-pill {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 4px 8px;
  border: 1px solid #2a2a2a;
  border-radius: 999px;
  background: #151515;
}

.tab-collapsed .metrics,
.tab-collapsed .controls,
.tab-collapsed .dept-meta,
.tab-collapsed .dept-controls { display: none !important; }
.tab-header { cursor: pointer; }

/* Full-screen overlay for department detail */
.overlay-panel {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.35);
  display: flex;
  align-items: stretch;
  justify-content: flex-end;
  z-index: 40;
  backdrop-filter: blur(2px);
  /* Allow underlying org chart to remain interactive */
  pointer-events: none;
}
.overlay-panel.hidden { display: none; }
.overlay-content {
  width: clamp(var(--overlay-width-min, 300px), var(--overlay-width-pref, 45vw), var(--overlay-width-max, 900px));
  max-width: 100%;
  height: 100%;
  background: var(--sidepanel-bg, var(--card-bg));
  color: var(--sidepanel-color, inherit);
  border-left: var(--sidepanel-border-left, 1px solid var(--card-border));
  box-shadow: var(--sidepanel-shadow, -8px 0 24px rgba(0,0,0,0.5));
  padding: var(--sidepanel-padding, 20px);
  overflow: auto;
  /* Slide-in animation */
  transform: translateX(100%);
  transition: transform 240ms ease;
  /* Capture interactions inside panel */
  pointer-events: auto;
}
/* When panel is visible, slide content in */
.overlay-panel:not(.hidden) .overlay-content { transform: translateX(0); }
.overlay-header { display: flex; align-items: center; justify-content: space-between; gap: 12px; margin-bottom: 12px; }
.overlay-title { font-size: var(--sidepanel-header-font-size, 22px); font-weight: var(--sidepanel-header-font-weight, 800); color: var(--sidepanel-header-color, inherit); }
.overlay-header { margin-bottom: var(--sidepanel-header-margin-bottom, 12px); border-bottom: var(--sidepanel-header-border-bottom, 1px solid #333333); padding-bottom: var(--sidepanel-header-padding-bottom, 10px); }
.overlay-subtitle { font-size: 13px; opacity: 0.85; }
.grid { display: grid; gap: 12px; }
.grid.agents { grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); }
.agent-mini { border: 1px solid var(--card-border); background: #151515; border-radius: 10px; padding: 12px; display: grid; gap: 6px; }
.agent-mini .mini-header { display: flex; align-items: center; justify-content: space-between; }
.agent-mini .mini-title { font-weight: 700; }
.mini-meta { font-size: 12px; opacity: 0.85; }
.mini-actions { display: flex; gap: 8px; }

/* Dim but keep interactive when overlay is open */
.canvas-container.dimmed { filter: blur(1px) brightness(0.95); transition: filter 200ms ease; }

/* Overlay agent details section */
.overlay-agent-details { border: 1px solid var(--card-border); background: #151515; border-radius: 12px; padding: 14px; margin-top: 8px; }
.overlay-agent-details .details-header { display: flex; align-items: center; justify-content: space-between; }
.overlay-agent-details .details-title { font-weight: 800; }
.overlay-agent-details .details-sub { font-size: 12px; opacity: 0.85; }
.overlay-agent-details .task-list { margin-top: 10px; }

@media (max-width: 720px) {
  .overlay-content { width: 100%; }
}

.dept-controls {
  display: grid;
  grid-template-columns: 1fr auto 1fr;
  align-items: center;
  gap: 8px;
}
.dept-controls .control-group {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}
.dept-controls .control-divider {
  width: 1px;
  height: 100%;
  background: #2a2a2a;
}
.control-btn.danger {
  border-color: #7a2b2b;
  color: #ffb4b4;
}
.control-btn.danger:hover {
  background: #3a1515;
  color: #fff;
}

/* Responsiveness: stack controls on narrow cards */
@media (max-width: 720px) {
  .dept-controls { grid-template-columns: 1fr; }
  .dept-controls .control-divider { display: none; }
}

/* Side panel scrollbar (WebKit) */
.overlay-content::-webkit-scrollbar { width: var(--sidepanel-scrollbar-width, 8px); }
.overlay-content::-webkit-scrollbar-track { background: var(--sidepanel-scrollbar-bg, #1A1A1A); }
.overlay-content::-webkit-scrollbar-thumb { background: var(--sidepanel-scrollbar-thumb-bg, #333333); border-radius: var(--sidepanel-scrollbar-thumb-radius, 4px); }

/* Firefox scrollbar */
.overlay-content { scrollbar-width: thin; scrollbar-color: var(--sidepanel-scrollbar-thumb-bg, #333333) var(--sidepanel-scrollbar-bg, #1A1A1A); }


