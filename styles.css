:root {
  --container-bg: #0f0f0f;
  --text-color: #ffffff;
  --card-bg: #1a1a1a;
  --card-border: #333333;
  --line-stroke: #555555;
  /* Tokens: status colors and grid/focus */
  --status-active: #00ff00;
  --status-idle: #ffd700;
  --status-error: #ff4500;
  --status-active-glow: rgba(0,255,0,0.5);
  --status-idle-glow: rgba(255,215,0,0.5);
  --status-error-glow: rgba(255,69,0,0.5);
  --grid-size: 24px;
  --stage-grid: radial-gradient(rgba(255,255,255,0.03) 1px, transparent 1px);
  --focus-outline: #9aa0ff;
  /* Typography tokens */
  --font-size-title: 18px;
  --font-size-role: 13px;
  --font-size-tag: 12px;
}

* { box-sizing: border-box; }
html, body, #app-root { height: 100%; }
body {
  margin: 0;
  background: var(--container-bg);
  color: var(--text-color);
  font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
}

.toolbar {
  position: sticky;
  top: 0;
  z-index: 10;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 16px;
  background: rgba(18,18,18,0.9);
  border-bottom: 1px solid #222;
  backdrop-filter: blur(8px);
}
.toolbar .legend { margin-left: 12px; opacity: 0.9; }
.status-dot {
  display: inline-block;
  width: 10px;
  height: 10px;
  border-radius: 50%;
  margin-right: 6px;
  box-shadow: 0 0 6px rgba(255,255,255,0.25);
}
.status-active { background: var(--status-active); box-shadow: 0 0 10px var(--status-active-glow); }
.status-idle   { background: var(--status-idle); box-shadow: 0 0 10px var(--status-idle-glow); }
.status-error  { background: var(--status-error); box-shadow: 0 0 10px var(--status-error-glow); }

/* Subtle pulse for real-time feel, avoids layout shift */
.status-dot::after {
  content: "";
  display: block;
  width: 100%;
  height: 100%;
  border-radius: 50%;
}
.status-active::after { --status-pulse-color: rgba(0,255,0,0.35); animation: status-pulse 1.6s infinite ease-out; }
.status-idle::after   { --status-pulse-color: rgba(255,215,0,0.35); animation: status-pulse 2.2s infinite ease-out; }
.status-error::after  { --status-pulse-color: rgba(255,69,0,0.35); animation: status-pulse 1.2s infinite ease-out; }
@keyframes status-pulse {
  0% { box-shadow: 0 0 0 0 var(--status-pulse-color, rgba(255,255,255,0.2)); }
  100% { box-shadow: 0 0 0 10px rgba(0,0,0,0); }
}

.btn {
  appearance: none;
  border: 1px solid #444;
  background: transparent;
  color: #ccc;
  border-radius: 8px;
  padding: 8px 14px;
  font-weight: 600;
  cursor: pointer;
  transition: transform 120ms ease, background 120ms ease, color 120ms ease;
}
.btn:hover { background: #2a2a2a; color: #fff; }
.btn-primary {
  border: none;
  background: linear-gradient(135deg, #6366F1 0%, #8B5CF6 100%); /* gradient from design.json */
  color: #fff;
  font-size: 14px;
  font-weight: 600;
}
.btn-primary:hover { 
  transform: scale(1.05); 
  background: linear-gradient(135deg, #5B5FE8 0%, #8048F0 100%); /* hover gradient from design.json */
}

.btn.active {
  background: #4a5568;
  border-color: #6b7280;
  color: #fff;
}

/* Layout Controls */
.layout-controls {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-left: 16px;
}

.layout-select {
  background: #1A1A1A;
  color: #CCCCCC;
  border: 1px solid #444444;
  border-radius: 8px;
  padding: 10px 12px;
  font-size: 14px;
  font-weight: 600;
  min-width: 140px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.layout-select:hover {
  background: #2A2A2A;
  border-color: #555555;
  color: #FFFFFF;
  transform: scale(1.02);
}

.layout-select:focus {
  outline: 2px solid #6366F1;
  outline-offset: 2px;
  border-color: #6366F1;
}

.layout-select option {
  background: #1A1A1A;
  color: #FFFFFF;
  padding: 8px;
}

/* Login page tweaks reuse existing tokens */
.login-container { min-height: 100vh; display: grid; place-items: center; background: var(--container-bg); color: var(--text-color); }
.login-card { width: min(420px, 92vw); background: var(--card-bg); border: 1px solid var(--card-border); border-radius: 14px; box-shadow: 0 20px 60px rgba(0,0,0,0.6); padding: 20px; display: grid; gap: 14px; }
.login-title { font-size: 22px; font-weight: 800; }
.login-sub { font-size: 13px; opacity: 0.85; }
.login-form { display: grid; gap: 10px; }
.login-form input { width: 100%; background: #111; color: #fff; border: 1px solid #333; border-radius: 8px; padding: 10px; }
.login-actions { display: grid; gap: 8px; }
.btn-google { background: #fff; color: #111; border: none; border-radius: 8px; padding: 10px 14px; font-weight: 700; cursor: pointer; display: inline-flex; align-items: center; justify-content: center; gap: 8px; }
.btn-google:hover { filter: brightness(0.95); }
.error { color: #ffb4b4; font-size: 12px; }
.success { color: #86efac; font-size: 12px; }

/* Focus visibility for keyboard users */
.btn:focus-visible,
.control-btn:focus-visible,
.agent-card:focus-visible,
.overlay-content:focus-visible,
.link:focus-visible {
  outline: 2px solid var(--focus-outline);
  outline-offset: 2px;
}

.canvas-container {
  position: relative;
  height: calc(100vh - 56px);
  overflow: hidden; /* prevent default scrollbars; zoom/pan handles navigation */
}
.stage {
  position: relative;
  transform-origin: 0 0;
  will-change: transform; /* smoother zoom/pan */
  background-image: var(--stage-grid);
  background-size: var(--grid-size) var(--grid-size);
}
.stage.hidden-in-onboarding {
  background-image: none !important;
}
.connections {
  position: absolute;
  inset: 0;
  /* width/height are set dynamically to content size */
  pointer-events: none;
}
.hidden-in-onboarding .connections,
.hidden-in-onboarding .cards-layer { display: none !important; }
.cards-layer {
  position: absolute;
  inset: 0;
  /* width/height are set dynamically to content size */
}

.zoom-controls {
  position: absolute;
  right: 16px;
  bottom: 16px;
  display: flex;
  gap: 8px;
}

.agent-card {
  position: absolute;
  /* actual width/height applied inline for responsiveness */
  background: var(--card-bg);
  color: #fff;
  border: 1px solid var(--card-border);
  border-radius: 12px;
  padding: 18px 20px;
  box-shadow: 0 8px 32px rgba(0,0,0,0.4);
  user-select: none;
  transition: transform 150ms ease, box-shadow 150ms ease, border-color 150ms ease;
}

.agent-card.compact {
  padding: 12px 16px;
  border-radius: 8px;
  box-shadow: 0 4px 16px rgba(0,0,0,0.3);
}

.agent-card.compact .agent-title {
  font-size: 16px;
  font-weight: 600;
}

.agent-card.compact .agent-role {
  font-size: 11px;
}

.agent-card.compact .dept-tag {
  padding: 4px 8px;
  font-size: 10px;
  margin-bottom: 6px;
}

.agent-card.compact .metrics {
  font-size: 11px;
  margin-top: 8px;
}
.agent-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 12px 40px rgba(0,0,0,0.6);
  border-color: #444444;
}
.agent-header { 
  display: flex; 
  align-items: center; 
  justify-content: space-between; 
  margin-bottom: 8px; 
  gap: 8px;
}

.collapse-btn {
  appearance: none;
  background: transparent;
  border: 1px solid #555;
  color: #ccc;
  border-radius: 4px;
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 14px;
  cursor: pointer;
  transition: all 120ms ease;
  flex-shrink: 0;
}

.collapse-btn:hover {
  background: #333;
  border-color: #666;
  color: #fff;
}

.collapse-btn:focus-visible {
  outline: 2px solid var(--focus-outline);
  outline-offset: 2px;
}
.agent-title { font-weight: 700; font-size: var(--font-size-title, 18px); }
.agent-role { opacity: 0.85; font-size: var(--font-size-role, 13px); }
.dept-tag { display: inline-block; padding: 8px 14px; border-radius: 8px; font-size: var(--font-size-tag, 12px); font-weight: 700; margin-bottom: 10px; }
.metrics { display: flex; gap: 14px; margin-top: 12px; opacity: 0.95; font-size: 13px; }
.controls { display: flex; gap: 10px; margin-top: 12px; flex-wrap: wrap; }
.control-btn { border: 1px solid #444; background: transparent; color: #ccc; padding: 8px 12px; border-radius: 10px; cursor: pointer; }
.control-btn:hover { background: #2a2a2a; color: #fff; }

.connection-path { 
  stroke: var(--line-stroke); 
  stroke-width: 2.5; 
  fill: none; 
  opacity: 0.8; 
  pointer-events: auto; 
  vector-effect: non-scaling-stroke;
  stroke-linecap: round;
  stroke-linejoin: round;
  transition: opacity 200ms ease, stroke-width 200ms ease;
}

.connection-path:hover {
  opacity: 1;
  stroke-width: 3;
}

/* Testing connection styles */
.connection-path.testing {
  stroke: var(--testing-line-stroke, #22c55e);
  stroke-width: var(--testing-line-width, 2.5);
  stroke-dasharray: var(--testing-line-dash, 6 6);
  opacity: 0.9;
}

/* Agent detail panel */
.detail-panel {
  position: fixed;
  top: 56px;
  right: 0;
  width: clamp(var(--overlay-width-min, 300px), var(--overlay-width-pref, 45vw), var(--overlay-width-max, 900px));
  max-width: 92vw;
  height: calc(100vh - 56px);
  background: var(--sidepanel-bg, var(--card-bg));
  color: var(--sidepanel-color, inherit);
  border-left: var(--sidepanel-border-left, 1px solid var(--card-border));
  box-shadow: var(--sidepanel-shadow, -8px 0 24px rgba(0,0,0,0.4));
  padding: var(--sidepanel-padding, 16px);
  overflow: auto;
  z-index: 45;
  transform: translateX(100%);
  transition: transform 220ms ease;
}
.detail-panel.open { transform: translateX(0); }
.detail-panel[aria-hidden="true"] { pointer-events: none; }
.detail-panel h3 { margin: 0 0 8px; }
.detail-panel .subtle { opacity: 0.8; font-size: 12px; margin-bottom: 12px; }
.task-list { list-style: none; padding: 0; margin: 12px 0; display: flex; flex-direction: column; gap: 8px; }
.task-item { border: 1px solid var(--card-border); border-radius: 8px; padding: 10px; background: #151515; }
.task-item .meta { display: flex; gap: 8px; font-size: 12px; opacity: 0.85; align-items: center; flex-wrap: wrap; }
.task-actions { display: flex; gap: 8px; margin-top: 8px; }
.task-actions .link { color: #9aa0ff; cursor: pointer; }
.task-actions .link:hover { text-decoration: underline; }
.task-form { display: grid; gap: 8px; margin-top: 16px; }
.task-form input, .task-form select, .task-form textarea { width: 100%; background: #111; color: #fff; border: 1px solid #333; border-radius: 6px; padding: 8px; }
.task-form textarea { min-height: 80px; }

/* Sort control styling using theme tokens */
.sort-wrap { display: inline-flex; align-items: center; gap: 8px; }
.sort-wrap select {
  background: var(--control-bg, #111);
  color: var(--control-color, var(--text-color));
  border: 1px solid var(--control-border-color, var(--card-border));
  border-radius: var(--control-radius, 6px);
  padding: 6px 8px;
  font-size: 12px;
  box-shadow: none;
}
.sort-wrap select:hover { background: var(--control-hover-bg, #2a2a2a); color: var(--control-hover-color, #fff); }

/* Side panel scrollbar for detail-panel (WebKit) */
.detail-panel::-webkit-scrollbar { width: var(--sidepanel-scrollbar-width, 8px); }
.detail-panel::-webkit-scrollbar-track { background: var(--sidepanel-scrollbar-bg, #1A1A1A); }
.detail-panel::-webkit-scrollbar-thumb { background: var(--sidepanel-scrollbar-thumb-bg, #333333); border-radius: var(--sidepanel-scrollbar-thumb-radius, 4px); }

/* Firefox */
.detail-panel { scrollbar-width: thin; scrollbar-color: var(--sidepanel-scrollbar-thumb-bg, #333333) var(--sidepanel-scrollbar-bg, #1A1A1A); }

/* Task status pills */
.task-status { display: inline-flex; align-items: center; gap: 6px; padding: 2px 8px; border-radius: 999px; font-size: 11px; }
.task-status.pending::before { content: "⏳"; font-size: 12px; line-height: 1; }
.task-status.in-progress::before { content: "↻"; font-size: 12px; line-height: 1; }
.task-status.done::before { content: "✓"; font-size: 12px; line-height: 1; }
.task-status.pending { background: #2a2a1a; color: #f5d76e; border: 1px solid #6a5b2a; }
.task-status.in-progress { background: #1a2a2a; color: #6ee7d8; border: 1px solid #2a6a6a; }
.task-status.done { background: #1a2a1a; color: #86efac; border: 1px solid #2a6a2a; }

/* Time summary */
.time-summary { display: grid; gap: 8px; margin: 8px 0 12px; }
.time-total { font-size: 13px; opacity: 0.9; }
.time-chart { width: 100%; height: 64px; border: 1px solid #2a2a2a; border-radius: 8px; background: #101010; padding: 6px; display: grid; align-items: end; grid-auto-flow: column; gap: 6px; }
.time-bar { background: #4a53d8; border-radius: 4px 4px 0 0; }
.time-bar.low { background: #60a5fa; }
.time-bar.medium { background: #8b5cf6; }
.time-bar.high { background: #f472b6; }

/* Time estimate pill for clarity */
.time-pill {
  display: inline-flex;
  margin-left: 6px;
  padding: 1px 6px;
  border-radius: 999px;
  border: 1px solid #2a2a2a;
  background: #0f0f0f;
  color: #d1d5db;
}

/* Backdrop for agent panel */
.backdrop {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.5);
  z-index: 40;
  opacity: 0;
  transition: opacity 200ms ease;
}
.backdrop.hidden { display: none; }
.backdrop.visible { display: block; opacity: 1; }

/* Tooltip for testing connections */
.tooltip { position: fixed; background: #111; color: #fff; border: 1px solid #333; border-radius: 6px; padding: 6px 8px; font-size: 12px; pointer-events: none; z-index: 30; }
.tooltip.hidden { display: none; }

/* Empty states */
.empty { opacity: 0.8; font-size: 13px; border: 1px dashed #333; padding: 12px; border-radius: 8px; text-align: center; }

/* Department card layout enhancements */
.dept-card {
  display: grid;
  grid-template-rows: auto auto auto;
  gap: 10px;
}
.dept-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  margin-bottom: 4px;
}
.dept-title { font-size: 18px; font-weight: 800; }
.dept-subtitle { font-size: 13px; opacity: 0.85; }

.dept-meta {
  display: flex;
  align-items: center;
  flex-wrap: wrap;
  gap: 8px 12px;
  font-size: 12px;
  opacity: 0.95;
}
.dept-meta .meta-pill {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 4px 8px;
  border: 1px solid #2a2a2a;
  border-radius: 999px;
  background: #151515;
}

.tab-collapsed .metrics,
.tab-collapsed .controls,
.tab-collapsed .dept-meta,
.tab-collapsed .dept-controls { display: none !important; }
.tab-header { cursor: pointer; }

/* Full-screen overlay for department detail */
.overlay-panel {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.35);
  display: flex;
  align-items: stretch;
  justify-content: flex-end;
  z-index: 40;
  backdrop-filter: blur(2px);
  /* Capture interactions to prevent background clicks leaking */
  pointer-events: auto;
}
.overlay-panel.hidden { display: none; }
.overlay-content {
  width: clamp(var(--overlay-width-min, 300px), var(--overlay-width-pref, 45vw), var(--overlay-width-max, 900px));
  max-width: 100%;
  height: 100%;
  background: var(--sidepanel-bg, var(--card-bg));
  color: var(--sidepanel-color, inherit);
  border-left: var(--sidepanel-border-left, 1px solid var(--card-border));
  box-shadow: var(--sidepanel-shadow, -8px 0 24px rgba(0,0,0,0.5));
  padding: var(--sidepanel-padding, 20px);
  overflow: auto;
  /* Slide-in animation */
  transform: translateX(100%);
  transition: transform 240ms ease;
  /* Capture interactions inside panel */
  pointer-events: auto;
}
/* When panel is visible, slide content in */
.overlay-panel:not(.hidden) .overlay-content { transform: translateX(0); }
.overlay-header { display: flex; align-items: center; justify-content: space-between; gap: 12px; margin-bottom: 12px; }
.overlay-title { font-size: var(--sidepanel-header-font-size, 22px); font-weight: var(--sidepanel-header-font-weight, 800); color: var(--sidepanel-header-color, inherit); }
.overlay-header { margin-bottom: var(--sidepanel-header-margin-bottom, 12px); border-bottom: var(--sidepanel-header-border-bottom, 1px solid #333333); padding-bottom: var(--sidepanel-header-padding-bottom, 10px); }
.overlay-subtitle { font-size: 13px; opacity: 0.85; }
.grid { display: grid; gap: 12px; }
.grid.agents { grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); }
.agent-mini { border: 1px solid var(--card-border); background: #151515; border-radius: 10px; padding: 12px; display: grid; gap: 6px; }
.agent-mini .mini-header { display: flex; align-items: center; justify-content: space-between; }
.agent-mini .mini-title { font-weight: 700; }
.mini-meta { font-size: 12px; opacity: 0.85; }
.mini-actions { display: flex; gap: 8px; }

/* Dim but keep interactive when overlay is open */
.canvas-container.dimmed { filter: blur(1px) brightness(0.95); transition: filter 200ms ease; }

/* Overlay agent details section */
.overlay-agent-details { border: 1px solid var(--card-border); background: #151515; border-radius: 12px; padding: 14px; margin-top: 8px; }
.overlay-agent-details .details-header { display: flex; align-items: center; justify-content: space-between; }
.overlay-agent-details .details-title { font-weight: 800; }
.overlay-agent-details .details-sub { font-size: 12px; opacity: 0.85; }
.overlay-agent-details .task-list { margin-top: 10px; }

/* Mobile Responsive Styles */
@media (max-width: 768px) {
  .toolbar {
    padding: 8px 12px;
    flex-wrap: wrap;
    gap: 8px;
  }
  
  .toolbar .toolbar-left {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
  }
  
  .layout-controls {
    margin-left: 0;
    margin-top: 8px;
    width: 100%;
    justify-content: space-between;
  }
  
  .layout-select {
    min-width: auto;
    flex: 1;
  }
  
  .agent-card {
    font-size: 14px;
  }
  
  .agent-card.compact {
    padding: 8px 12px;
  }
  
  .agent-title {
    font-size: 14px !important;
  }
  
  .agent-role {
    font-size: 10px !important;
  }
  
  .dept-tag {
    font-size: 9px !important;
    padding: 3px 6px !important;
  }
  
  .collapse-btn {
    width: 20px;
    height: 20px;
    font-size: 12px;
  }
  
  .detail-panel,
  .overlay-content {
    width: 100% !important;
    max-width: 100% !important;
  }
  
  .zoom-controls {
    bottom: 80px; /* Move up to avoid mobile browser UI */
    right: 8px;
    flex-direction: column;
  }
}

@media (max-width: 720px) {
  .dept-controls { 
    grid-template-columns: 1fr; 
  }
  .dept-controls .control-divider { 
    display: none; 
  }
}

.dept-controls {
  display: grid;
  grid-template-columns: 1fr auto 1fr;
  align-items: center;
  gap: 8px;
}
.dept-controls .control-group {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}
.dept-controls .control-divider {
  width: 1px;
  height: 100%;
  background: #2a2a2a;
}
.control-btn.danger {
  border-color: #7a2b2b;
  color: #ffb4b4;
}
.control-btn.danger:hover {
  background: #3a1515;
  color: #fff;
}

/* Responsiveness: stack controls on narrow cards */
@media (max-width: 720px) {
  .dept-controls { grid-template-columns: 1fr; }
  .dept-controls .control-divider { display: none; }
}

/* Side panel scrollbar (WebKit) */
.overlay-content::-webkit-scrollbar { width: var(--sidepanel-scrollbar-width, 8px); }
.overlay-content::-webkit-scrollbar-track { background: var(--sidepanel-scrollbar-bg, #1A1A1A); }
.overlay-content::-webkit-scrollbar-thumb { background: var(--sidepanel-scrollbar-thumb-bg, #333333); border-radius: var(--sidepanel-scrollbar-thumb-radius, 4px); }

/* Firefox scrollbar */
.overlay-content { scrollbar-width: thin; scrollbar-color: var(--sidepanel-scrollbar-thumb-bg, #333333) var(--sidepanel-scrollbar-bg, #1A1A1A); }


/* Welcome overlay (first-run guided setup) */
.welcome-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.6);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 60;
}
.welcome-overlay.hidden { display: none; }
.welcome-modal {
  width: min(860px, 92vw);
  background: var(--card-bg);
  color: var(--text-color);
  border: 1px solid var(--card-border);
  border-radius: 14px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.6);
  padding: 20px;
  display: grid;
  gap: 16px;
  animation: fadeIn 180ms ease;
}
.fade-in-scale { animation: fadeScale 220ms ease both; }
.drawn { stroke-dasharray: 1000; stroke-dashoffset: 1000; animation: draw 600ms ease forwards; }

@keyframes fadeIn { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: none; } }
@keyframes fadeScale { from { opacity: 0; transform: scale(0.96); } to { opacity: 1; transform: scale(1); } }
@keyframes draw { to { stroke-dashoffset: 0; } }
.welcome-header { display: grid; gap: 6px; }
.welcome-title { font-size: 22px; font-weight: 800; }
.welcome-sub { font-size: 13px; opacity: 0.85; }
.welcome-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 12px; }
.welcome-tile {
  border: 1px solid var(--card-border);
  background: #151515;
  border-radius: 10px;
  padding: 12px;
  display: grid;
  gap: 8px;
  cursor: pointer;
  transition: transform 120ms ease, border-color 120ms ease, box-shadow 120ms ease, opacity 120ms ease;
  opacity: 0.5;
}
.welcome-tile.selected { opacity: 1; border-color: #4a4a4a; box-shadow: 0 6px 20px rgba(0,0,0,0.35); }
.welcome-tile .dept-tag { margin: 0; }
.welcome-actions { display: flex; justify-content: space-between; gap: 8px; }
.welcome-actions .right { display: flex; gap: 8px; }
.welcome-radio { display: grid; gap: 8px; }
.welcome-summary { border: 1px solid var(--card-border); background: #151515; border-radius: 10px; padding: 12px; }
.hint-bar {
  position: fixed;
  bottom: 12px;
  left: 50%;
  transform: translateX(-50%);
  background: #151515;
  border: 1px solid var(--card-border);
  color: var(--text-color);
  border-radius: 999px;
  padding: 10px 14px;
  z-index: 50;
  box-shadow: 0 10px 30px rgba(0,0,0,0.4);
}

/* Generic action modal (for forms like Add Agent/Department) */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.5);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 70;
}
.modal-overlay.open { display: flex; }
.modal {
  width: min(520px, 94vw);
  background: var(--card-bg);
  color: var(--text-color);
  border: 1px solid var(--card-border);
  border-radius: 12px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.6);
  padding: 16px;
  display: grid;
  gap: 10px;
}
.modal h3 { margin: 0 0 6px; }
.modal .form { display: grid; gap: 10px; }
.modal .row { display: grid; gap: 6px; }
.modal input, .modal select { width: 100%; background: #111; color: #fff; border: 1px solid #333; border-radius: 6px; padding: 8px; }
.modal .actions { display: flex; justify-content: flex-end; gap: 8px; }

